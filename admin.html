<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>VoLab Admin | Tam Kontrol</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    
    <!-- Firebase Çekirdek ve Veritabanı -->
    <script src="https://www.gstatic.com/firebasejs/10.8.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore-compat.js"></script>
    
    <!-- FCM v1 Yetkilendirme için Şifreleme Kütüphanesi -->
    <script src="https://kjur.github.io/jsrsasign/jsrsasign-all-min.js"></script>

    <link rel="stylesheet" href="css/main.css">

    <style>
        .hidden { display: none !important; }
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .live-pulse { width: 8px; height: 8px; background: #22c55e; border-radius: 50%; display: inline-block; animation: pulse 2s infinite; }
        @keyframes pulse { 0% { opacity: 1; transform: scale(1); } 50% { opacity: 0.5; transform: scale(1.2); } 100% { opacity: 1; transform: scale(1); } }
    </style>
</head>
<body class="bg-[#07070a] text-white p-4 overflow-y-auto">

    <div id="errorBox" class="fixed top-5 left-1/2 -translate-x-1/2 z-[1000] hidden w-[90%] max-w-md">
        <div class="bg-slate-900 border border-cyan-500 text-cyan-200 px-6 py-4 rounded-3xl shadow-2xl flex items-center backdrop-blur-xl border-l-4 border-l-cyan-500">
            <i data-lucide="shield-alert" class="w-5 h-5 mr-3 text-cyan-500"></i>
            <span class="text-xs font-black tracking-widest uppercase" id="errorMessage">MESAJ</span>
        </div>
    </div>

    <!-- ÜST BAR -->
    <header class="flex justify-between items-center mb-6 bg-slate-900/60 p-5 rounded-[2.5rem] border border-white/5">
        <div>
            <h1 class="text-xl font-black italic uppercase">VoLab Admin</h1>
            <div id="apiStatus" class="flex items-center gap-2 mt-1">
                <div class="live-pulse"></div>
                <span class="text-[8px] font-black text-slate-500 uppercase tracking-widest">Sistem Aktif</span>
            </div>
        </div>
        <button type="button" onclick="window.AdminModule.logout()" class="text-red-500 bg-red-500/10 p-3 rounded-2xl cursor-pointer active:scale-90"><i data-lucide="power"></i></button>
    </header>

    <!-- SEKME ÇUBUĞU -->
    <div class="flex gap-2 mb-6 overflow-x-auto no-scrollbar pb-2">
        <button type="button" onclick="window.AdminModule.switchTab('add')" id="btn_tab_add" class="whitespace-nowrap px-6 py-4 bg-cyan-600 rounded-2xl font-black text-[10px] uppercase tracking-widest text-white shadow-lg transition-all cursor-pointer">Analiz Ekle</button>
        <button type="button" onclick="window.AdminModule.switchTab('active')" id="btn_tab_active" class="whitespace-nowrap px-6 py-4 bg-slate-800 rounded-2xl font-black text-[10px] uppercase tracking-widest text-slate-400 transition-all cursor-pointer">Yayında Olanlar</button>
        <button type="button" onclick="window.AdminModule.switchTab('uefa')" id="btn_tab_uefa" class="whitespace-nowrap px-6 py-4 bg-slate-800 rounded-2xl font-black text-[10px] uppercase tracking-widest text-slate-400 transition-all cursor-pointer flex items-center gap-1"><i data-lucide="trophy" class="w-3 h-3 text-blue-400"></i> UEFA</button>
        <button type="button" onclick="window.AdminModule.switchTab('notify')" id="btn_tab_notify" class="whitespace-nowrap px-6 py-4 bg-slate-800 rounded-2xl font-black text-[10px] uppercase tracking-widest text-slate-400 transition-all cursor-pointer flex items-center gap-1"><i data-lucide="bell-ring" class="w-3 h-3 text-yellow-400"></i> Bildirim</button>
        <button type="button" onclick="window.AdminModule.switchTab('feedback')" id="btn_tab_feedback" class="whitespace-nowrap px-6 py-4 bg-slate-800 rounded-2xl font-black text-[10px] uppercase tracking-widest text-slate-400 transition-all cursor-pointer">İstek / Şikayet</button>
        <button type="button" onclick="window.AdminModule.switchTab('users')" id="btn_tab_users" class="whitespace-nowrap px-6 py-4 bg-slate-800 rounded-2xl font-black text-[10px] uppercase tracking-widest text-slate-400 transition-all cursor-pointer">Kullanıcılar</button>
    </div>

    <!-- BÖLÜM 1: STANDART ANALİZ EKLEME -->
    <div id="adminSectionAdd" class="block space-y-6">
        <div class="bg-[#1e293b]/30 p-6 rounded-[2.5rem] border border-white/5 shadow-2xl space-y-5">
             <button onclick="window.AdminModule.openApiMatcher()" class="w-full bg-slate-800 border border-cyan-500/30 py-4 rounded-2xl flex items-center justify-center gap-3 active:scale-95 transition-all">
                <i data-lucide="link" class="w-4 h-4 text-cyan-400"></i>
                <span id="apiMatchText" class="text-[10px] font-black text-cyan-400 uppercase tracking-widest">API İLE EŞLEŞTİR (OPSİYONEL)</span>
            </button>
            
            <div class="relative" id="customLeagueDropdownWrapper">
                <input type="hidden" id="matchLeague" value="">
                <button type="button" onclick="window.AdminModule.toggleLeagueDropdown()" id="btnLeagueSelect" class="w-full bg-[#0f172a] border border-white/10 rounded-2xl p-5 text-sm font-black outline-none flex items-center justify-between text-slate-400 transition-all cursor-pointer">
                    <span id="leagueSelectText" class="flex items-center gap-3 uppercase tracking-widest text-[11px]">LİG SEÇİN...</span>
                    <i data-lucide="chevron-down" id="leagueSelectIcon" class="w-4 h-4 text-slate-500 transition-transform duration-300"></i>
                </button>
                <div id="leagueDropdownBody" class="hidden absolute z-50 left-0 right-0 top-full mt-2 bg-[#0f172a] border border-cyan-500/30 rounded-2xl max-h-64 overflow-y-auto shadow-[0_20px_50px_rgba(0,0,0,0.9)] no-scrollbar p-2 flex flex-col gap-1 backdrop-blur-md"></div>
            </div>

            <div class="flex gap-4">
                <div onclick="window.AdminModule.openTeamSelector('home')" class="w-1/2 bg-[#0f172a] border border-white/5 rounded-2xl p-5 flex items-center justify-between cursor-pointer active:bg-slate-800 transition-colors">
                    <span id="homeTeamText" class="truncate font-black text-[10px] uppercase text-slate-400">EV SAHİBİ</span>
                    <img id="homeTeamPreview" src="" class="w-8 h-8 hidden object-contain">
                </div>
                <div onclick="window.AdminModule.openTeamSelector('away')" class="w-1/2 bg-[#0f172a] border border-white/5 rounded-2xl p-5 flex items-center justify-between cursor-pointer active:bg-slate-800 transition-colors">
                    <span id="awayTeamText" class="truncate font-black text-[10px] uppercase text-slate-400">DEPLASMAN</span>
                    <img id="awayTeamPreview" src="" class="w-8 h-8 hidden object-contain">
                </div>
            </div>
            <select id="matchCategory" class="w-full bg-[#0f172a] border border-cyan-500/30 rounded-2xl p-5 text-sm font-black outline-none appearance-none text-cyan-400">
                <option value="Ana Sayfa" selected>ANA SAYFA</option>
                <option value="Günün Kombinesi">GÜNÜN KOMBİNESİ</option>
                <option value="Tek Maç">TEK MAÇ</option>
                <option value="Canlı Bahisler">CANLI Bahisler</option>
            </select>
            <input type="text" id="prediction" class="w-full bg-[#0f172a] border border-white/10 rounded-2xl p-5 text-sm font-black focus:border-cyan-500 outline-none" placeholder="Tahmin Detayı">
            <div class="flex items-center justify-between bg-black/30 p-5 rounded-3xl border border-white/5">
                <label class="flex items-center cursor-pointer"><input type="checkbox" id="isVip" class="mr-3 w-6 h-6 accent-purple-500"><span class="text-xs font-black text-purple-400 uppercase">VIP (KİLİTLİ)</span></label>
                <div class="flex items-center"><input type="number" id="confidence" value="85" class="w-14 bg-transparent text-center text-green-400 font-black text-2xl outline-none"><span class="text-green-400 font-black text-xl">%</span></div>
            </div>
            <button type="button" onclick="window.AdminModule.addNewMatch()" class="w-full bg-gradient-to-r from-cyan-600 to-blue-600 py-6 rounded-3xl font-black shadow-2xl active:scale-95 uppercase italic tracking-widest">ANALİZİ YAYINLA</button>
        </div>
    </div>

    <!-- BÖLÜM 2: YAYINDA OLANLAR -->
    <div id="adminSectionActive" class="hidden">
        <div id="adminMatchesList" class="space-y-6 pb-32"></div>
    </div>

    <!-- BÖLÜM 3: UEFA YÖNETİMİ -->
    <div id="adminSectionUefa" class="hidden">
        <div class="bg-blue-900/20 p-6 rounded-[2.5rem] border border-blue-500/30 shadow-2xl space-y-5">
            <select id="uefaTournament" class="w-full bg-[#0f172a] border border-blue-500/40 rounded-2xl p-5 text-sm font-black outline-none appearance-none text-white">
                <option value="UCL">UEFA Şampiyonlar Ligi</option>
                <option value="UEL">UEFA Avrupa Ligi</option>
                <option value="UECL">UEFA Konferans Ligi</option>
            </select>
            <div class="flex gap-4">
                <div onclick="window.AdminModule.openGlobalTeamSelector('home')" class="w-1/2 bg-[#0f172a] border border-white/5 rounded-2xl p-5 flex items-center justify-between cursor-pointer active:bg-slate-800 transition-colors">
                    <span id="uefaHomeText" class="truncate font-black text-[10px] uppercase text-blue-300">EV SAHİBİ</span>
                    <img id="uefaHomePreview" src="" class="w-8 h-8 hidden object-contain">
                </div>
                <div onclick="window.AdminModule.openGlobalTeamSelector('away')" class="w-1/2 bg-[#0f172a] border border-white/5 rounded-2xl p-5 flex items-center justify-between cursor-pointer active:bg-slate-800 transition-colors">
                    <span id="uefaAwayText" class="truncate font-black text-[10px] uppercase text-blue-300">DEPLASMAN</span>
                    <img id="uefaAwayPreview" src="" class="w-8 h-8 hidden object-contain">
                </div>
            </div>
            <input type="text" id="uefaPrediction" class="w-full bg-[#0f172a] border border-white/10 rounded-2xl p-5 text-sm font-black outline-none" placeholder="UEFA Tahmin Detayı">
            <div class="flex items-center justify-between bg-black/40 p-5 rounded-3xl border border-white/5">
                <label class="flex items-center cursor-pointer"><input type="checkbox" id="uefaIsVip" class="mr-3 w-6 h-6 accent-purple-500"><span class="text-xs font-black text-purple-400 uppercase">VIP</span></label>
                <div class="flex items-center"><input type="number" id="uefaConfidence" value="90" class="w-14 bg-transparent text-center text-green-400 font-black text-2xl outline-none"><span class="text-green-400 font-black text-xl">%</span></div>
            </div>
            <button type="button" onclick="window.AdminModule.addUefaMatch()" class="w-full bg-gradient-to-r from-blue-600 to-indigo-600 py-6 rounded-3xl font-black shadow-2xl active:scale-95 uppercase italic tracking-widest">UEFA MAÇINI YAYINLA</button>
        </div>
        <div id="adminUefaMatchesList" class="space-y-6 pb-32 mt-8"></div>
    </div>

    <!-- BÖLÜM 4: BİLDİRİM GÖNDERME MERKEZİ (FCM v1 GÜNCEL) -->
    <div id="adminSectionNotify" class="hidden">
        <div class="bg-gradient-to-br from-yellow-900/20 to-slate-900/80 p-6 rounded-[2.5rem] border border-yellow-500/30 shadow-2xl space-y-5">
            <div class="flex items-center gap-3 mb-2">
                <div class="w-12 h-12 bg-yellow-500/10 rounded-full flex items-center justify-center border border-yellow-500/30">
                    <i data-lucide="radio-tower" class="w-5 h-5 text-yellow-400"></i>
                </div>
                <div>
                    <h3 class="text-white font-black italic text-lg uppercase tracking-tighter">Bildirim Merkezi</h3>
                    <p class="text-[9px] text-yellow-200/50 font-bold uppercase tracking-widest">v1 Yeni Nesil Altyapı</p>
                </div>
            </div>

            <div class="space-y-4">
                <!-- YETKİ DOSYASI SEÇİCİ -->
                <div class="bg-black/50 p-4 rounded-2xl border border-dashed border-yellow-500/30">
                    <label class="text-[8px] font-black text-yellow-500 uppercase block mb-2">1. Adım: Yetki Dosyası (JSON)</label>
                    <input type="file" id="fcmKeyFile" accept=".json" class="hidden" onchange="window.AdminModule.handleFcmKeyFile(this)">
                    <button onclick="document.getElementById('fcmKeyFile').click()" class="w-full py-3 bg-yellow-500/10 border border-yellow-500/20 rounded-xl text-[9px] font-black text-yellow-500 uppercase tracking-widest flex items-center justify-center gap-2">
                        <i data-lucide="file-key" class="w-4 h-4"></i>
                        <span id="fcmKeyStatus">HİZMET ANAHTARI SEÇİN</span>
                    </button>
                </div>

                <div>
                    <label class="text-[8px] font-black text-slate-500 uppercase ml-2 mb-1 block">2. Adım: Başlık</label>
                    <input type="text" id="notifyTitle" class="w-full bg-[#0f172a] border border-white/10 rounded-2xl p-4 text-sm font-black text-white focus:border-yellow-500 outline-none" placeholder="Örn: Yeni VIP Analiz Yayında!">
                </div>
                <div>
                    <label class="text-[8px] font-black text-slate-500 uppercase ml-2 mb-1 block">3. Adım: Mesaj</label>
                    <textarea id="notifyBody" rows="3" class="w-full bg-[#0f172a] border border-white/10 rounded-2xl p-4 text-xs font-medium text-slate-300 focus:border-yellow-500 outline-none resize-none" placeholder="Kullanıcılara iletilecek mesaj..."></textarea>
                </div>
                
                <div class="bg-black/40 p-4 rounded-2xl border border-white/5">
                    <label class="flex items-center cursor-pointer">
                        <input type="checkbox" id="notifyOnlyVip" class="mr-3 w-5 h-5 accent-purple-500">
                        <span class="text-[10px] font-black text-purple-400 uppercase tracking-widest">SADECE PRO (VIP) KULLANICILARA GÖNDER</span>
                    </label>
                </div>

                <button type="button" id="btnSendNotify" onclick="window.AdminModule.sendPushNotification()" class="w-full bg-gradient-to-r from-yellow-600 to-orange-600 py-5 rounded-2xl font-black text-white shadow-[0_10px_20px_rgba(234,179,8,0.2)] active:scale-95 uppercase tracking-widest text-[11px] flex items-center justify-center gap-2 opacity-50 cursor-not-allowed" disabled>
                    <i data-lucide="send" class="w-4 h-4"></i>
                    <span>BİLDİRİMİ ATEŞLE</span>
                </button>
            </div>
        </div>
    </div>

    <!-- BÖLÜM 5: İSTEK VE ŞİKAYETLER -->
    <div id="adminSectionFeedback" class="hidden">
        <div id="adminFeedbackList" class="space-y-6 pb-32"></div>
    </div>

    <!-- BÖLÜM 6: KULLANICI LİSTESİ -->
    <div id="adminSectionUsers" class="hidden">
        <div id="adminUsersList" class="space-y-6 pb-32"></div>
    </div>

    <!-- MODALLAR -->
    <div id="apiSelectorModal" class="fixed inset-0 bg-black/95 z-[99999] hidden flex-col items-center justify-end backdrop-blur-md">
        <div class="absolute inset-0" onclick="window.AdminModule.closeApiMatcher()"></div>
        <div class="bg-[#0f172a] w-full max-w-md rounded-t-[3.5rem] border-t border-white/10 relative max-h-[85vh] flex flex-col z-10">
            <div class="p-8 border-b border-white/5 flex justify-between items-center">
                <h3 class="font-black text-2xl italic uppercase text-cyan-400">Canlı API</h3>
                <button onclick="window.AdminModule.closeApiMatcher()" class="text-slate-500 p-3"><i data-lucide="x"></i></button>
            </div>
            <div id="apiMatchesGrid" class="p-6 overflow-y-auto pb-20 no-scrollbar space-y-4"></div>
        </div>
    </div>

    <div id="teamSelectorModal" class="fixed inset-0 bg-black/95 z-[99999] hidden flex-col items-center justify-end backdrop-blur-md">
        <div class="absolute inset-0" onclick="window.AdminModule.closeTeamSelector()"></div>
        <div class="bg-[#0f172a] w-full max-w-md rounded-t-[3.5rem] border-t border-white/10 relative max-h-[85vh] flex flex-col z-10 shadow-2xl">
            <div id="teamGrid" class="p-6 grid grid-cols-3 gap-5 overflow-y-auto no-scrollbar"></div>
        </div>
    </div>

    <div id="globalTeamSelectorModal" class="fixed inset-0 bg-black/95 z-[99999] hidden flex-col items-center justify-end backdrop-blur-md">
        <div class="absolute inset-0" onclick="window.AdminModule.closeGlobalTeamSelector()"></div>
        <div class="bg-[#0f172a] w-full max-w-md rounded-t-[3.5rem] border-t border-white/10 relative h-[90vh] flex flex-col z-10">
            <div id="globalTeamGrid" class="p-4 grid grid-cols-3 gap-4 overflow-y-auto no-scrollbar"></div>
        </div>
    </div>

    <!-- Motor Dosyaları -->
    <script src="js/firebase-config.js"></script>
    <script src="js/data.js"></script>
    <script src="js/api.js"></script>
    <script src="js/admin.js"></script>
    <script>if(window.lucide) window.lucide.createIcons();</script>
</body>
</html>